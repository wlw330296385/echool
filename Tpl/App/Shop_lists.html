<!doctype html>
<html>

<head>
    <title>{$title}</title>
    <meta charset="utf-8" />
    <!--页面优化-->
    <meta name="MobileOptimized" content="320">
    <!--默认宽度320-->
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <!--viewport 等比 不缩放-->
    <meta http-equiv="cleartype" content="on">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!--删除苹果菜单-->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!--默认颜色-->
    <meta name="apple-mobile-web-app-title" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <!--加载全部后 显示-->
    <meta content="telephone=no" name="format-detection" />
    <!--不识别电话-->
    <meta content="email=no" name="format-detection" />
    <link rel="stylesheet" href="__PUBLIC__/App/css/style.css" />
    <link rel="stylesheet" href="__PUBLIC__/App/css/dropload.css" />
    <!--组件依赖js begin-->
    <script src="__PUBLIC__/App/js/zepto.min.js"></script>
    <script src="__PUBLIC__/App/js/fx.js"></script>
    <script src="__PUBLIC__/App/js/fx_methods.js"></script>
	
    <script type="text/javascript" src="__PUBLIC__/App/gmu/iscroll.js"></script>
    <script type="text/javascript" src="__PUBLIC__/App/gmu/gmu.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/App/gmu/widget.js"></script>
    <script type="text/javascript" src="__PUBLIC__/App/gmu/navigator.js"></script>
    <script type="text/javascript" src="__PUBLIC__/App/gmu/scrollable.js"></script>
    <script type="text/javascript" src="__PUBLIC__/App/js/zepto.picLazyLoad.js"></script>
    <!--组件依赖js end-->
    <!--轮播js begin-->
    <script src="__PUBLIC__/App/js/tool.js"></script>
    <script src="__PUBLIC__/App/js/swipe.js"></script>
	<script src="__PUBLIC__/App/js/dropload.min.js"></script>
    <style>
    <style> .pp-follow {
        padding: 0.2em 0px;
        width: 100%;
        background: #e4dcd1;
        display: block;
    }
    
    .p-fopic {
        margin-left: 1%;
        float: left;
        width: 12.5%;
        border-radius: 3px;
        margin-top: 2%;
    }
    
    .p-focon {
        float: left;
        margin-left: 2%;
        width: 60%;
        color: #000000;
        font-size: 0.9em;
        line-height: 3.2em;
    }
    
    .p-fofo {
        margin-top: 1.5%;
        margin-left: 1%;
        float: left;
        width: 22.5%;
        color: #fff;
        font-size: 0.9em;
        text-align: center;
        line-height: 2.5em;
        background: #df0e11;
        border-radius: 0.3em;
    }
    
    .p-fofo a,
    .p-fofo a:visited {
        color: #fff;
        font-size: 0.9em;
        text-align: center;
        line-height: 2.5em;
    }
    
    .clear {
        clear: both;
    }
    
    .showImg-div {
        height: 160px;
    }
    
    .showImg {
        width: 100%;
        overflow: hidden;
    }
    
    #wrap {
        width: 100%
    }
    .secondNav{width: 100%;display: none;background: #99CCCC;}
    .secondNav ul{overflow: hidden;padding-top: 10px;}
    .secondNav ul li{float: left;margin-bottom: 10px;margin-left: 20px;text-align: center}
    .secondNav ul li p{margin-top: 5px}
    .secondNav ul li a:link{color: #fff}
    .secondNav ul li a:visited{color: #fff}

    #search{padding: 8px 0; background: #fff; text-align: center;}
    #searchkey{ background: #f1f1f1; border-radius: 5px;padding: 6px 10px; width: 90% ; font-size: 0.8em }
    #btn_search{ border: none; border-radius: 5px;padding: 6px 10px; width: 90%; background: #f1f1f1; }

    .wrap{margin:5px auto;}
    .roll-wrap{ text-align: center;padding:5px; background: #fff}
    .roll-wrap ul{ height:20px;overflow:hidden; }
    .roll-wrap li a{ font-size: 0.8em; color: red }

    .nothink{ text-align: center; padding: 30px 0; color:#999 }
    </style>
</head>

<body class="index">    
    <div class="zbb_index">
    <br>
    <br>
        <div id="search">
            <div style="width: 80%; float: left;">
                <input type="text" name="key" id="searchkey" placeholder="点这里搜你想买的东西" />
            </div>
            <div style="width: 20%; float: right">
                <button id="btn_search">搜索</button>
            </div>
            <div style="clear: both"></div>        
        </div>
        <!-- 排序 -->
        <div class="ads-tabs ovflw">
            <a href="JavaScript:;" class="fl text-c" data-sorts="dissells" data-order="1"><span>销量<b></b></span>
            <a href="JavaScript:;" class="fl text-c" data-sorts="price" data-order="1"><span>价格<b></b></span></a>
            <a href="JavaScript:;" class="fl text-c" data-sorts="id" data-order="1"><span>最新<b></b></span></a>
            <a href="JavaScript:;" class="fl text-c" data-sorts="sorts" data-order="1"><span>好评<b></b></span></a>
        </div>
        <!-- 全部列表页 -->
        <div class="index-alst">
            <!-- 导航 -->
                
            <!-- 二级菜单 -->
            <!-- 第一个 -->
            <div class="secondNav">
            </div>
            <empty name="cache">
                <div class="nothink">本类商品现在还没上架</div>
            </empty>
            <!-- 产品列表 -->
            <div class="index-plist ovflw" id="index-plist">
                <ul class="plist-ul ovflw">
                    <volist name="cache" id="vo" page="$pages">
                        <li>
                            <a href="{:U('App/Shop/goods',array('sid'=>0,'id'=>$vo['id'],'ppid'=>$_SESSION['WAP']['vipid']))}">
                                <div class="showImg-div"><img class="showImg LazyLoad" src="__PUBLIC__/App/img/point_loading.png" data-original="{$vo.imgurl}" /></div>
                                <!--图片尺寸：336*259-->
                                <h1 class="plist-tt fonts4 ovflw" style="height:30px;">{$vo.name}</h1>
                                <p><span class="plist-yp color3"><i class="fonts3">￥</i><em class="fonts1">{$vo.price}</em>&nbsp;<span class="plist-xp fonts3">原价￥{$vo.oprice}</span></span>&nbsp;
                                <neq name="vo.dissells" value="0">
                                    <span class="fonts3 color2">已售{$vo.dissells}</span>
                                </neq></p>
                            </a>
                        </li>
                    </volist>
                </ul>
            </div>
            <!-- <p style="text-align:center;margin:20px"><a style="color:#666;font-size:0.8em;" href="{:U('App/Shop/lists')}">展开全部分类...</a></p> -->
            <!-- <div>{$pages}</div> -->
        </div>
        <!-- 底部导航 -->
        <include file="./Tpl/App/Shop_footer.html" />
    </div>
    <script type="text/javascript">
        $('.LazyLoad').picLazyLoad({effect: "fadeIn"});
        $(function(){
            $('#btn_search').click(function(){
                k = $('#searchkey').val();
                if(k != ''){
                    window.location.href = "{:U('App/Shop/lists')}?k="+k;
                }
            });
        // list();
        //排序
        $('.ads-tabs a').on('click',function(){
            $('.ads-tabs a').each(function(){
                $(this).find('span').removeClass('active');
            })
            $(this).find('span').addClass('active');
            var type='{$type}';
            var k='{$k}';
            var gid='{$gid}';
            var sorts=$(this).data('sorts');
            var ord=($(this).data('order')==1)?2:1;
            var str='';
            var pramdata={
                'sorts':sorts,
                'order':ord,
                'type':type,
                'k':k,
                'gid':gid
            };
            console.log(pramdata);
            $.post("{:U('App/Shop/lists')}",pramdata,function(data){
                var gurl="http://www.gxeschool.com/App/Shop/goods/sid/0/ppid/{$_SESSION['WAP']['vipid']}";
                for (var i = 0; i < data.length; i++) {
                        str+='<li><a href="'+gurl+'/id/'+data[i].id+'">';
                            str+='<div class="showImg-div"><img class="showImg LazyLoad" src="__PUBLIC__/App/img/point_loading.png" data-original="'+data[i].imgurl+'" /></div>';
                                str+='<h1 class="plist-tt fonts4 ovflw" style="height:30px;">'+data[i].name+'</h1><p><span class="plist-yp color3"><i class="fonts3">￥</i><em class="fonts1">'+data[i].price+'</em>&nbsp;<span class="plist-xp fonts3">原价￥'+data[i].oprice+'</span></span>&nbsp;<span class="fonts3 color2">已售'+data[i].dissells+'</span>';
                                str+='</neq></p></a></li>';
                }
                $('.plist-ul').html(str);
                $('.LazyLoad').picLazyLoad();
            },'json');
            var srrow='';
            $('.ads-tabs b').html('');
            (ord)==1?srrow='↓':srrow='↑';
            $(this).attr('data-order',ord);
            $(this).find('b').html(srrow);
            
        })
        })
    </script>
    <!--新版分享特效-->
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script>
    //var share_url = "{$_SESSION['WAP']['shopset']['url']}/App/Shop/index/ppid/{$_SESSION['WAP']['vipid']}/";
    var share_url = "http://{$_SERVER['HTTP_HOST']}__ROOT__/App/Shop/index/ppid/{$_SESSION['WAP']['vipid']}/";
    var share_title = "{$_SESSION['WAP']['shopset']['name']}";
    var share_content = "{$_SESSION['SET']['wxsummary']}";
    var share_img = "{$_SESSION['WAP']['shopset']['url']}{$_SESSION['WAP']['shopset']['sharepic']}";

    wx.config({
        debug: false,
        appId: "{$jsapi['appId']}",
        timestamp: "{$jsapi['timestamp']}",
        nonceStr: "{$jsapi['nonceStr']}",
        signature: "{$jsapi['signature']}",
        jsApiList: [
            'checkJsApi',
            'onMenuShareTimeline',
            'onMenuShareAppMessage',
            'onMenuShareQQ',
            'onMenuShareWeibo',
            'hideMenuItems',
            'showMenuItems',
            'hideAllNonBaseMenuItem',
            'showAllNonBaseMenuItem',
        ]
    });

    wx.ready(function() {
        //开启菜单
        wx.showOptionMenu();
        //隐藏菜单
        //wx.hideOptionMenu();
        //分享给朋友
        wx.onMenuShareAppMessage({
            title: share_title,
            desc: share_content,
            link: share_url,
            imgUrl: share_img,
            trigger: function(res) {
                //alert('用户点击发送给朋友');
            },
            success: function(res) {
                //alert('已分享');
            },
            cancel: function(res) {
                //alert('已取消');
            },
            fail: function(res) {
                //alert(JSON.stringify(res));
            }
        });
        //分享到朋友圈
        wx.onMenuShareTimeline({
            title: share_title,
            link: share_url,
            imgUrl: share_img,
            trigger: function(res) {
                //alert('用户点击分享到朋友圈');
            },
            success: function(res) {
                //alert('已分享');
            },
            cancel: function(res) {
                //alert('已取消');
            },
            fail: function(res) {
                //alert(JSON.stringify(res));
            }
        });
        //分享到QQ
        wx.onMenuShareQQ({
            title: share_title,
            desc: share_content,
            link: share_url,
            imgUrl: share_img,
            trigger: function(res) {
                //alert('用户点击分享到QQ');
            },
            complete: function(res) {
                //alert(JSON.stringify(res));
            },
            success: function(res) {
                //alert('已分享');
            },
            cancel: function(res) {
                //alert('已取消');
            },
            fail: function(res) {
                //alert(JSON.stringify(res));
            }
        });
    });
    </script>
	
</body>
<script src="http://apps.bdimg.com/libs/angular.js/1.4.6/angular.min.js"></script>
<script type="text/javascript">
    // function GetUrl(name){
    //    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i");
    //    var r = window.location.search.substr(1).match(reg);
    //    if (r!=null) return (r[2]); return null;
    // }

    // var k=GetUrl('k');
    // var gid=GetUrl('gid');
    // var p = 1;
    // function list(){   
    // // 每页展示4个
    // var num = 4;
    // var pageStart = 0,pageEnd = 0;
    // var url='/App/Shop/lists';
    //     if(k){
    //         url+='/k/'+k;
    //     }
    //     if(gid){
    //         url+='/gid/'+gid;
    //     }
    // // dropload
    // $('#index-plist').dropload({
    //     scrollArea : window,
    //     domUp : {
    //         domClass   : 'dropload-up',
    //         domRefresh : '<div class="dropload-refresh">↓下拉刷新</div>',
    //         domUpdate  : '<div class="dropload-update">↑释放更新</div>',
    //         domLoad    : '<div class="dropload-load"><span class="loading"></span>加载中...</div>'
    //     },
    //     domDown : {
    //         domClass   : 'dropload-down',
    //         domRefresh : '<div class="dropload-refresh">上拉加载更多商品(｡･∀･)ﾉﾞ</div>',
    //         domLoad    : '<div class="dropload-load"><span class="loading"></span>正在加载...</div>',
    //         domNoData  : '<div class="dropload-noData">抱歉o(>﹏<)o没有更多商品了...</div>'
    //     },
        
    //     loadDownFn : function(me){
    //         p++;
    //         $.ajax({
    //             type: 'GET',
    //             url: url+'/p/'+p,
    //             dataType: 'json',
    //             success: function(data){
    //                 var result = '';
    //                 for(var i = 0; i < data.length; i++){                   
    //                     result +='<li><a href="App/Shop/goods/'+data[i].id+'"><div class="showImg-div"><img class="showImg" src="'+data[i].imgurl+'" /></div><h1 class="plist-tt fonts4 ovflw" style="height:30px;">'+data[i].name+'</h1><p><span class="plist-yp color3"><i class="fonts3">￥</i><em class="fonts1">'+data[i].price+'</em></span>&nbsp;</p></a></li>';
    //                     if((i + 1) >= data.length){
    //                         // 锁定
    //                         // me.lock();
    //                         // // 无数据
    //                         me.noData();
    //                         break;
    //                     }  
    //                 }
    //                 // 为了测试，延迟1秒加载
    //                 setTimeout(function(){
    //                     $('.plist-ul').append(result);
    //                     // 每次数据加载完，必须重置
    //                     me.resetload();
    //                 },1000);
    //             },
    //             error: function(){
    //                  me.lock();
    //                  me.noData();
    //                 // var str='<p>没有更多商品了</p>';
    //                 // $('.plist-ul').append(str);
    //                 // 即使加载出错，也得重置
    //                 me.resetload();
    //             }
    //         });
    //     }
    // }); 
    // }
    
</script>
</html>
